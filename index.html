<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Username's GitHub Page</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS for the minimalist blue-accent theme with animations */
        :root {
            --primary-bg: #F4F7F9;
            --secondary-bg: #FFFFFF;
            --text-color: #1A202C;
            --accent-blue: #4299E1;
            --accent-blue-light: #BEE3F8;
            --accent-blue-dark: #3182CE;
            --border-color: #E2E8F0;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: var(--primary-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 2rem 1rem;
            box-sizing: border-box;
            scroll-behavior: smooth;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: var(--secondary-bg);
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }
        
        header h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
        }

        nav {
            display: flex;
            justify-content: center;
            background-color: var(--accent-blue);
            padding: 0.5rem 0;
        }

        nav a {
            color: var(--secondary-bg);
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.3s ease;
            position: relative;
            z-index: 1;
        }

        nav a:hover {
            background-color: var(--accent-blue-dark);
            transform: scale(1.05);
        }

        nav a.active {
            background-color: var(--accent-blue-dark);
        }

        .content {
            padding: 2rem;
            overflow: hidden;
        }

        .subpage {
            opacity: 0;
            transition: opacity 0.5s ease;
            display: none;
        }

        .subpage.active {
            opacity: 1;
            display: block;
        }

        .page-wrapper {
            position: relative;
            min-height: 400px;
            overflow-y: auto;
            padding: 2rem;
            max-height: calc(100vh - 200px);
        }
        
        /* Ensure the sub-nav has enough space when sticky */
        .page-wrapper.scrolled {
            padding-top: 5rem; /* Add padding to prevent content from hiding behind the sticky nav */
        }

        /* General content styling */
        h2 {
            font-size: 1.6rem;
            color: var(--accent-blue-dark);
            border-bottom: 2px solid var(--accent-blue-light);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        
        #past-semesters h2 {
            margin-bottom: 0;
        }

        h3 {
            font-size: 1.2rem;
            color: var(--accent-blue-dark);
            margin-top: 2rem;
            padding-top: 1rem;
        }

        p {
            line-height: 1.6;
        }

        /* Sub-navigation for Past Semesters Index */
        .sub-nav {
            display: flex;
            justify-content: flex-start;
            gap: 1rem;
            margin: 0 -2rem 2rem -2rem; /* remove the extra top margin */
            padding: 1rem 2rem;
            background-color: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: -32px; /* equal to the height of the main nav bar */
            z-index: 10;
        }
        
        .sub-nav a {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            background-color: var(--primary-bg);
            color: var(--text-color);
            text-decoration: none;
            transition: background-color 0.3s ease;
            font-weight: 600;
        }

        .sub-nav a:hover {
            background-color: var(--border-color);
        }

        .sub-nav a.active {
            background-color: var(--accent-blue);
            color: white;
        }

        .course-link {
            display: block;
            background-color: var(--primary-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-decoration: none;
            color: var(--text-color);
            margin-bottom: 1rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .course-link:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1);
        }

        .course-link h4 {
            margin: 0;
            color: var(--accent-blue);
        }

        /* Module-specific styling */
        .tool-block, .cipher-block {
            background-color: var(--primary-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-top: 1.5rem;
        }

        .tool-block:hover, .cipher-block:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1);
        }

        .tool-block h3, .cipher-block h3 {
            margin-top: 0;
            color: var(--accent-blue);
        }

        .tool-form, .cipher-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-row {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        input[type="text"], input[type="number"], textarea, select {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            border-radius: 4px;
            font-size: 1rem;
            background-color: var(--secondary-bg);
            width: 100%;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .radio-group, .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        button {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        button:hover {
            background-color: var(--accent-blue-dark);
            transform: translateY(-2px);
        }

        .result-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--accent-blue-light);
            border-radius: 8px;
            border: 1px solid var(--accent-blue);
        }
        
        .result-box h4 {
            margin-top: 0;
            color: var(--accent-blue-dark);
            border-bottom: 1px solid var(--accent-blue);
            padding-bottom: 0.5rem;
        }

        .step-by-step {
            white-space: pre-wrap;
            line-height: 1.4;
            font-size: 0.9rem;
        }
        
        .formula {
            font-family: monospace;
            white-space: pre-wrap;
            line-height: 1.4;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        #treasure-board {
            display: grid;
            gap: 5px;
            margin-top: 1rem;
        }
        
        .treasure-cell {
            width: 40px;
            height: 40px;
            background-color: var(--primary-bg);
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .treasure-cell:hover {
            background-color: var(--accent-blue-light);
        }
        
        .treasure-cell.opened {
            cursor: default;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
            }

            nav a {
                text-align: center;
                border-bottom: 1px solid var(--accent-blue-dark);
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>My GitHub Page</h1>
        </header>

        <nav>
            <a href="#eng335" class="active">ENG335</a>
            <a href="#ict225">ICT225</a>
            <a href="#ict239">ICT239</a>
            <a href="#ict318">ICT318</a>
            <a href="#past-semesters">Past Semesters</a>
        </nav>

        <div class="page-wrapper">
            <!-- Current Semester Courses -->
            <div id="eng335" class="subpage active">
                <h2>ENG335 - Machine Learning</h2>
                <p>Welcome to the Machine Learning section. This page will be updated with projects and information related to ENG335, covering topics such as supervised learning, unsupervised learning, neural networks, and model evaluation.</p>
                <p>Stay tuned for future updates and code examples!</p>
            </div>
            
            <div id="ict225" class="subpage">
                <h2>ICT225 - Management Information Systems</h2>
                <p>This section is dedicated to my work in Management Information Systems (ICT225). Here you'll find information on how technology and information systems are used to support business operations, decision-making, and organizational strategy.</p>
                <p>Topics include enterprise systems, data management, and the role of MIS in modern organizations.</p>
            </div>
            
            <div id="ict239" class="subpage">
                <h2>ICT239 - Web Application Development</h2>
                <p>Explore my projects from the Web Application Development course (ICT239). This page will showcase my skills in front-end and back-end web technologies, including HTML, CSS, JavaScript, and various frameworks.</p>
                <p>Future content will include live demos and source code for the applications I develop.</p>
            </div>
            
            <div id="ict318" class="subpage">
                <h2>ICT318 - Network Security</h2>
                <p>This is the hub for Network Security (ICT318). Below, you can explore and interact with three classic ciphers: Caesar, Vigenère, and Vernam. Use the tools to encipher or decipher text and see the step-by-step solution for each operation.</p>
                
                <div class="cipher-block">
                    <!-- Caesar Cipher -->
                    <h3>Caesar Cipher</h3>
                    <div class="cipher-form">
                        <div class="form-row">
                            <label for="caesar-text">Plaintext / Ciphertext</label>
                            <textarea id="caesar-text" rows="3" placeholder="Enter text here..."></textarea>
                        </div>
                        <div class="form-row">
                            <label for="caesar-key">Key (1-25)</label>
                            <input type="number" id="caesar-key" min="1" max="25" value="3">
                        </div>
                        <div class="radio-group">
                            <label><input type="radio" name="caesar-mode" value="encipher" checked> Encipher</label>
                            <label><input type="radio" name="caesar-mode" value="decipher"> Decipher</label>
                        </div>
                        <button onclick="runCaesarCipher()">Run Caesar Cipher</button>
                    </div>
                    <div id="caesar-result" class="result-box" style="display:none;">
                        <h4>Result & Steps</h4>
                        <pre class="step-by-step"></pre>
                    </div>
                </div>

                <!-- Vigenère Cipher -->
                <div class="cipher-block">
                    <h3>Vigenère Cipher</h3>
                    <div class="cipher-form">
                        <div class="form-row">
                            <label for="vigenere-text">Plaintext / Ciphertext</label>
                            <textarea id="vigenere-text" rows="3" placeholder="Enter text here..."></textarea>
                        </div>
                        <div class="form-row">
                            <label for="vigenere-key">Key (word or phrase)</label>
                            <input type="text" id="vigenere-key" placeholder="Enter key here...">
                        </div>
                        <div class="radio-group">
                            <label><input type="radio" name="vigenere-mode" value="encipher" checked> Encipher</label>
                            <label><input type="radio" name="vigenere-mode" value="decipher"> Decipher</label>
                        </div>
                        <button onclick="runVigenereCipher()">Run Vigenère Cipher</button>
                    </div>
                    <div id="vigenere-result" class="result-box" style="display:none;">
                        <h4>Result & Steps</h4>
                        <pre class="step-by-step"></pre>
                    </div>
                </div>

                <!-- Vernam Cipher -->
                <div class="cipher-block">
                    <h3>Vernam Cipher (One-Time Pad)</h3>
                    <p style="font-size:0.9rem;">
                        The key must be the same length as the plaintext/ciphertext.
                    </p>
                    <div class="cipher-form">
                        <div class="form-row">
                            <label for="vernam-text">Plaintext / Ciphertext</label>
                            <textarea id="vernam-text" rows="3" placeholder="Enter text here..."></textarea>
                        </div>
                        <div class="form-row">
                            <label for="vernam-key">Key (same length as text)</label>
                            <input type="text" id="vernam-key" placeholder="Enter key here...">
                        </div>
                        <div class="radio-group">
                            <label><input type="radio" name="vernam-mode" value="encipher" checked> Encipher</label>
                            <label><input type="radio" name="vernam-mode" value="decipher"> Decipher</label>
                        </div>
                        <button onclick="runVernamCipher()">Run Vernam Cipher</button>
                    </div>
                    <div id="vernam-result" class="result-box" style="display:none;">
                        <h4>Result & Steps</h4>
                        <pre class="step-by-step"></pre>
                    </div>
                </div>
            </div>

            <!-- Past Semesters Combined Page -->
            <div id="past-semesters" class="subpage">
                <h2>Past Semesters</h2>
                <div class="sub-nav">
                    <a href="#semester1-heading" id="nav-semester1" class="active">Semester 1</a>
                    <a href="#semester2-heading" id="nav-semester2">Semester 2</a>
                </div>
                
                <div id="semester1-content">
                    <h3 id="semester1-heading">Semester 1</h3>
                    <a href="#ict101" class="course-link">
                        <h4>ICT101 - Computational Thinking</h4>
                        <p>This course introduced the fundamentals of computational thinking, problem-solving, and algorithmic design.</p>
                    </a>
                    <a href="#ict114" class="course-link">
                        <h4>ICT114 - Computer Architecture</h4>
                        <p>An exploration of the structure and function of computer systems, including hardware components, memory organization, and data representation.</p>
                    </a>
                    <a href="#ict133" class="course-link">
                        <h4>ICT133 - Structured Programming</h4>
                        <p>This module focused on the principles of structured programming, including control structures, data types, and function design.</p>
                    </a>
                    <a href="#ict246" class="course-link">
                        <h4>ICT246 - Operating Systems</h4>
                        <p>A study of operating system concepts, including process management, memory management, file systems, and security.</p>
                    </a>
                    <a href="#sst101" class="course-link">
                        <h4>SST101 - Project Management</h4>
                        <p>This course covered the methodologies and practices of effective project management, from planning to execution and closure.</p>
                    </a>
                    <a href="#nco205" class="course-link">
                        <h4>NCO205 - User Centered Design</h4>
                        <p>Focusing on the principles of designing with the user in mind, this course covered usability, accessibility, and user research methods.</p>
                    </a>
                </div>
                
                <div id="semester2-content">
                    <h3 id="semester2-heading">Semester 2</h3>
                    <a href="#ict162" class="course-link">
                        <h4>ICT162 - Object Oriented Programming</h4>
                        <p>An introduction to object-oriented programming concepts, including classes, objects, inheritance, and polymorphism.</p>
                    </a>
                    <a href="#ict233" class="course-link">
                        <h4>ICT233 - Data Programming</h4>
                        <p>This module covered data manipulation and programming techniques for data analysis and visualization.</p>
                    </a>
                    <a href="#ict235" class="course-link">
                        <h4>ICT235 - Data Structures and Algorithms</h4>
                        <p>A deep dive into fundamental data structures and algorithms, including arrays, linked lists, trees, sorting, and searching.</p>
                    </a>
                    <a href="#ict259" class="course-link">
                        <h4>ICT259 - Computer Networking</h4>
                        <p>An overview of computer networking principles, from network architecture and protocols to security and wireless communication.</p>
                    </a>
                    <a href="#nco103" class="course-link">
                        <h4>NCO103 - Listen And Be Heard: Effective Communication Through Storytelling</h4>
                        <p>This course focused on developing communication skills through the art of storytelling and active listening.</p>
                    </a>
                    <a href="#nco203" class="course-link">
                        <h4>NCO203 - Critical Thinking and Problem Solving</h4>
                        <p>This module enhanced skills in critical thinking, logical reasoning, and structured problem-solving techniques.</p>
                    </a>
                </div>
            </div>
            
            <!-- Individual Module Pages -->
            <div id="ict101" class="subpage">
                <h2>ICT101 - Computational Thinking</h2>
                <p>This page is a placeholder for projects and details related to **ICT101**. This course introduced me to the core concepts of breaking down problems and designing efficient solutions. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="ict114" class="subpage">
                <h2>ICT114 - Computer Architecture</h2>
                <p>An exploration of the structure and function of computer systems, including hardware components, memory organization, and data representation.</p>
                
                <div class="tool-block">
                    <h3>Storage Formula Calculator</h3>
                    <p>Use this tool to calculate various storage performance metrics. Simply fill in the parameters and click a button to see the result!</p>
                    <div class="tool-form">
                        <div class="form-row">
                            <label for="si-unit">Resultant SI Unit:</label>
                            <select id="si-unit">
                                <option value="s">s</option>
                                <option value="ms" selected>ms</option>
                                <option value="us">μs</option>
                                <option value="ns">ns</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label for="hth-time">Head-To-Head Switching Time:</label>
                            <input type="text" id="hth-time" placeholder="e.g., 5us" value="5us">
                        </div>
                        <div class="form-row">
                            <label for="platters-count">Number of Platters:</label>
                            <input type="number" id="platters-count" value="4">
                        </div>
                        <div class="form-row">
                            <label for="ttt-time">Track-To-Track Seek Time:</label>
                            <input type="text" id="ttt-time" placeholder="e.g., 5ms" value="5ms">
                        </div>
                        <div class="form-row">
                            <label for="tracks-count">Number of Tracks/Platter Side:</label>
                            <input type="number" id="tracks-count" value="1000">
                        </div>
                        <div class="form-row">
                            <label for="rpm-speed">RPM:</label>
                            <input type="number" id="rpm-speed" value="12000">
                        </div>
                        <div class="form-row">
                            <label for="sectors-per-track">Sectors/Track:</label>
                            <input type="number" id="sectors-per-track" value="2048">
                        </div>
                        <div class="form-row">
                            <label for="bytes-per-sector">Bytes/Sector:</label>
                            <input type="number" id="bytes-per-sector" value="512">
                        </div>
                        <div class="form-row">
                            <label for="data-si-unit">Data SI Unit (for transfer rates):</label>
                            <select id="data-si-unit">
                                <option value="B">B</option>
                                <option value="K">KB</option>
                                <option value="M" selected>MB</option>
                                <option value="G">GB</option>
                            </select>
                        </div>
                    </div>
                    <div class="button-group" style="margin-top: 1rem;">
                        <button onclick="calculateAad()">Average Access Delay</button>
                        <button onclick="calculateSat()">Sequential Access Time</button>
                        <button onclick="calculateAat()">Average Access Time</button>
                        <button onclick="calculateMaxTransfer()">Max Data Transfer</button>
                        <button onclick="calculateSustainedTransfer()">Sustained Data Transfer</button>
                    </div>
                    <div id="tool-result" class="result-box" style="display:none;">
                        <h4>Result & Steps</h4>
                        <pre class="formula"></pre>
                        <pre class="step-by-step"></pre>
                    </div>
                </div>
            </div>
            <div id="ict133" class="subpage">
                <h2>ICT133 - Structured Programming</h2>
                <p>This module focused on the principles of structured programming, including control structures, data types, and function design.</p>
                
                <h3>Projects</h3>

                <div class="tool-block">
                    <h3>Super Anagram Checker</h3>
                    <div class="tool-form">
                        <div class="form-row">
                            <label for="anagram-word1">First Word</label>
                            <input type="text" id="anagram-word1" placeholder="Enter the first word">
                        </div>
                        <div class="form-row">
                            <label for="anagram-word2">Second Word</label>
                            <input type="text" id="anagram-word2" placeholder="Enter the second word">
                        </div>
                        <button onclick="checkSuperAnagram()">Check Anagram</button>
                    </div>
                    <div id="anagram-result" class="result-box" style="display:none;">
                        <h4>Result</h4>
                        <p class="step-by-step"></p>
                    </div>
                </div>

                <div class="tool-block">
                    <h3>Treasure Hunt Game</h3>
                    <div id="treasure-setup">
                        <div class="tool-form">
                            <div class="form-row">
                                <label for="player1-name">Player 1 Name</label>
                                <input type="text" id="player1-name" value="Player 1">
                            </div>
                            <div class="form-row">
                                <label for="player2-name">Player 2 Name</label>
                                <input type="text" id="player2-name" value="Player 2">
                            </div>
                            <div class="form-row">
                                <label for="board-size">Board Size (odd number, min 5)</label>
                                <input type="number" id="board-size" min="5" step="2" value="5">
                            </div>
                            <button onclick="setupTreasureHunt()">Start Game</button>
                        </div>
                    </div>
                    <div id="treasure-game-area" style="display:none;">
                         <div id="treasure-game-status" class="result-box" style="margin-top: 1rem;"></div>
                         <div id="treasure-board"></div>
                         <div id="treasure-game-controls" class="button-group" style="margin-top: 1rem;"></div>
                    </div>
                </div>
            </div>
            <div id="ict246" class="subpage">
                <h2>ICT246 - Operating Systems</h2>
                <p>This page is a placeholder for projects and details related to **ICT246**. I learned about the crucial role of an operating system in managing a computer's resources. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="sst101" class="subpage">
                <h2>SST101 - Project Management</h2>
                <p>This course covered the methodologies and practices of effective project management, from planning to execution and closure.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="nco205" class="subpage">
                <h2>NCO205 - User Centered Design</h2>
                <p>This page is a placeholder for projects and details related to **NCO205**. This module taught me the importance of designing with the user's needs and experience at the forefront. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="ict162" class="subpage">
                <h2>ICT162 - Object Oriented Programming</h2>
                <p>This page is a placeholder for projects and details related to **ICT162**. Here I learned the principles of object-oriented programming, which is key for creating modular and reusable code. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="ict233" class="subpage">
                <h2>ICT233 - Data Programming</h2>
                <p>This page is a placeholder for projects and details related to **ICT233**. This course gave me the skills to handle and analyze data programmatically. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="ict235" class="subpage">
                <h2>ICT235 - Data Structures and Algorithms</h2>
                <p>This page is a placeholder for projects and details related to **ICT235**. This fundamental course taught me how to organize and efficiently process data. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="ict259" class="subpage">
                <h2>ICT259 - Computer Networking</h2>
                <p>This page is a placeholder for projects and details related to **ICT259**. I gained a solid understanding of how computers communicate over networks and the protocols that govern them. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="nco103" class="subpage">
                <h2>NCO103 - Listen And Be Heard: Effective Communication Through Storytelling</h2>
                <p>This page is a placeholder for projects and details related to **NCO103**. This course helped me improve my communication skills through the art of storytelling. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
            <div id="nco203" class="subpage">
                <h2>NCO203 - Critical Thinking and Problem Solving</h2>
                <p>This page is a placeholder for projects and details related to **NCO203**. This module honed my ability to analyze complex problems and think critically to find solutions. You can fill this space with project summaries, code examples, and key takeaways from the course.</p>
                <p>Come back later to see more! ✨</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Element Selectors ---
            const navLinks = document.querySelectorAll('nav a');
            const subpages = document.querySelectorAll('.subpage');
            const pageWrapper = document.querySelector('.page-wrapper');

            // --- State Management ---
            // A variable to hold the "cleanup" function for our scroll listener.
            // This ensures we don't have multiple listeners running when we switch pages.
            let removePastSemestersListener = null;

            // --- Core Functions ---

            /**
             * Shows a specific subpage based on its ID (e.g., '#eng335')
             * and handles the setup/teardown of page-specific logic.
             * @param {string} pageId The ID of the page to show.
             */
            const showPage = (pageId) => {
                // 1. Clean up from the previous page. If a scroll listener for 'Past Semesters' exists, remove it.
                if (removePastSemestersListener) {
                    removePastSemestersListener();
                    removePastSemestersListener = null;
                }

                // 2. Hide all pages and deactivate all main navigation links.
                subpages.forEach(page => {
                    page.classList.remove('active');
                    page.style.display = 'none';
                });
                navLinks.forEach(link => link.classList.remove('active'));

                // 3. Find the target page to display.
                const targetPage = document.querySelector(pageId);
                if (!targetPage) {
                    // Fallback to the first page if the hash is invalid.
                    showPage(navLinks[0].getAttribute('href'));
                    return;
                }

                // 4. Activate the correct main navigation link.
                const mainNavLink = document.querySelector(`nav a[href="${pageId}"]`);
                if (mainNavLink) {
                    mainNavLink.classList.add('active');
                } else {
                    // This handles individual module pages, activating the 'Past Semesters' tab as their parent.
                    const pastSemestersLink = document.querySelector('nav a[href="#past-semesters"]');
                    if (pastSemestersLink) pastSemestersLink.classList.add('active');
                }

                // 5. Show the page with a fade-in effect.
                targetPage.style.display = 'block';
                setTimeout(() => {
                    targetPage.classList.add('active');
                    pageWrapper.scrollTop = 0; // Reset scroll position for the new page.

                    // 6. If this is the 'Past Semesters' page, set up its special scroll-aware navigation.
                    if (pageId === '#past-semesters') {
                        removePastSemestersListener = setupPastSemestersScrollListener();
                    }
                }, 10); // A tiny delay allows the CSS transition to work correctly.
            };

            /**
             * Sets up a scroll event listener for the 'Past Semesters' page.
             * This function highlights the sub-nav link ('Semester 1' or 'Semester 2')
             * based on the user's scroll position.
             * @returns {Function} A cleanup function to remove the event listener.
             */
            const setupPastSemestersScrollListener = () => {
                const subNav = document.querySelector('#past-semesters .sub-nav');
                const s1Link = document.getElementById('nav-semester1');
                const s2Link = document.getElementById('nav-semester2');
                const s1Heading = document.getElementById('semester1-heading');
                const s2Heading = document.getElementById('semester2-heading');

                if (!subNav || !s1Link || !s2Link || !s1Heading || !s2Heading) {
                    console.error("Required elements for Past Semesters scroll listener not found.");
                    return () => {}; // Return an empty cleanup function if setup fails.
                }

                const handleScroll = () => {
                    // Determine the "trigger line". When a heading crosses this line, the active link changes.
                    // It's the top of the scrollable area plus the height of the sticky sub-nav.
                    const scrollTriggerPosition = pageWrapper.scrollTop + subNav.offsetHeight;
                    const s1Top = s1Heading.offsetTop;
                    const s2Top = s2Heading.offsetTop;

                    // Logic to set the active link based on which heading is currently visible.
                    if (scrollTriggerPosition >= s2Top) {
                        s2Link.classList.add('active');
                        s1Link.classList.remove('active');
                    } else if (scrollTriggerPosition >= s1Top) {
                        s1Link.classList.add('active');
                        s2Link.classList.remove('active');
                    } else {
                        // Default to Semester 1 if scrolled above its heading.
                        s1Link.classList.add('active');
                        s2Link.classList.remove('active');
                    }
                };

                handleScroll(); // Run once on setup to set the initial state correctly.
                pageWrapper.addEventListener('scroll', handleScroll);

                // Return a "cleanup" function to be called when we navigate away from this page.
                return () => pageWrapper.removeEventListener('scroll', handleScroll);
            };

            // --- Event Listeners Setup ---

            // Main navigation click handler.
            document.querySelector('nav').addEventListener('click', (e) => {
                if (e.target.tagName === 'A' && e.target.getAttribute('href').startsWith('#')) {
                    e.preventDefault();
                    const targetId = e.target.getAttribute('href');
                    history.pushState(null, '', targetId); // Update URL without full reload.
                    showPage(targetId);
                }
            });
            
            // 'Past Semesters' sub-navigation click handler for smooth scrolling.
            document.querySelector('.sub-nav').addEventListener('click', (e) => {
                if (e.target.tagName === 'A' && e.target.getAttribute('href').startsWith('#')) {
                    e.preventDefault();
                    const targetId = e.target.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    const subNav = e.target.closest('.sub-nav');

                    if (targetElement && subNav) {
                        // Calculate where to scroll, accounting for the sticky sub-nav's height.
                        const topPos = targetElement.offsetTop - subNav.offsetHeight;
                        pageWrapper.scrollTo({
                            top: topPos,
                            behavior: 'smooth'
                        });
                    }
                }
            });

            // Handle browser back/forward button clicks.
            window.addEventListener('popstate', () => {
                const currentHash = window.location.hash || navLinks[0].getAttribute('href');
                showPage(currentHash);
            });

            // --- Initial Page Load ---
            const initialHash = window.location.hash || navLinks[0].getAttribute('href');
            showPage(initialHash);
        });

        /* --- Cipher Functions (Unchanged) --- */

        const getAlphabet = () => 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        function displayResult(result, steps, elementId) {
            const resultBox = document.getElementById(elementId);
            const stepPre = resultBox.querySelector('.step-by-step');
            stepPre.innerHTML = `Final Result: ${result}\n\n--- Step-by-Step Breakdown ---\n${steps.join('\n')}`;
            resultBox.style.display = 'block';
        }

        function runCaesarCipher() {
            const text = document.getElementById('caesar-text').value.toUpperCase();
            let key = parseInt(document.getElementById('caesar-key').value, 10);
            const mode = document.querySelector('input[name="caesar-mode"]:checked').value;
            const alphabet = getAlphabet();
            const steps = [];
            let result = '';

            function showMessage(message) {
                const resultBox = document.getElementById('caesar-result');
                const stepPre = resultBox.querySelector('.step-by-step');
                stepPre.innerHTML = message;
                resultBox.style.display = 'block';
            }

            if (isNaN(key) || key < 1 || key > 25) {
                showMessage('Please enter a valid key between 1 and 25.');
                return;
            }

            if (mode === 'decipher') {
                key = (26 - key) % 26;
            }
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (alphabet.includes(char)) {
                    const originalIndex = alphabet.indexOf(char);
                    const newIndex = (originalIndex + key) % 26;
                    const newChar = alphabet[newIndex];
                    result += newChar;
                    steps.push(`- ${mode === 'encipher' ? 'Plaintext' : 'Ciphertext'} character: ${char} (${originalIndex})`);
                    steps.push(`  Shift: ${mode === 'encipher' ? '' : '-'} ${document.getElementById('caesar-key').value}`);
                    steps.push(`  Calculation: (${originalIndex} + ${mode === 'encipher' ? key : (26-key)}) mod 26 = ${newIndex}`);
                    steps.push(`  Resulting character: ${newChar}`);
                } else {
                    result += char;
                    steps.push(`- Character "${char}" is not in the alphabet. It remains unchanged.`);
                }
            }
            
            displayResult(result, steps, 'caesar-result');
        }

        function runVigenereCipher() {
            const text = document.getElementById('vigenere-text').value.toUpperCase();
            let key = document.getElementById('vigenere-key').value.toUpperCase();
            const mode = document.querySelector('input[name="vigenere-mode"]:checked').value;
            const alphabet = getAlphabet();
            const steps = [];
            let result = '';
            
            function showMessage(message) {
                const resultBox = document.getElementById('vigenere-result');
                const stepPre = resultBox.querySelector('.step-by-step');
                stepPre.innerHTML = message;
                resultBox.style.display = 'block';
            }
            
            if (!key) {
                showMessage('Please enter a valid key.');
                return;
            }

            let keyIndex = 0;
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (alphabet.includes(char)) {
                    const charIndex = alphabet.indexOf(char);
                    const keyChar = key[keyIndex % key.length];
                    const keyIndexVal = alphabet.indexOf(keyChar);

                    let newIndex;
                    if (mode === 'encipher') {
                        newIndex = (charIndex + keyIndexVal) % 26;
                        steps.push(`- Plaintext char: ${char} (${charIndex}) | Key char: ${keyChar} (${keyIndexVal})`);
                        steps.push(`  Calculation: (${charIndex} + ${keyIndexVal}) mod 26 = ${newIndex}`);
                    } else {
                        newIndex = (charIndex - keyIndexVal + 26) % 26;
                        steps.push(`- Ciphertext char: ${char} (${charIndex}) | Key char: ${keyChar} (${keyIndexVal})`);
                        steps.push(`  Calculation: (${charIndex} - ${keyIndexVal} + 26) mod 26 = ${newIndex}`);
                    }
                    
                    const newChar = alphabet[newIndex];
                    result += newChar;
                    steps.push(`  Resulting character: ${newChar}`);
                    keyIndex++;
                } else {
                    result += char;
                    steps.push(`- Character "${char}" is not in the alphabet. It remains unchanged.`);
                }
            }
            
            displayResult(result, steps, 'vigenere-result');
        }

        function runVernamCipher() {
            const text = document.getElementById('vernam-text').value.toUpperCase();
            const key = document.getElementById('vernam-key').value.toUpperCase();
            const mode = document.querySelector('input[name="vernam-mode"]:checked').value;
            const alphabet = getAlphabet();
            const steps = [];
            let result = '';
            
            function showMessage(message) {
                const resultBox = document.getElementById('vernam-result');
                const stepPre = resultBox.querySelector('.step-by-step');
                stepPre.innerHTML = message;
                resultBox.style.display = 'block';
            }

            if (!key || key.length !== text.length) {
                showMessage('The key must be the same length as the text for the Vernam Cipher.');
                return;
            }

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const keyChar = key[i];
                
                if (alphabet.includes(char) && alphabet.includes(keyChar)) {
                    const charIndex = alphabet.indexOf(char);
                    const keyIndex = alphabet.indexOf(keyChar);
                    
                    let newIndex;
                    if (mode === 'encipher') {
                        newIndex = (charIndex + keyIndex) % 26;
                        steps.push(`- Plaintext char: ${char} (${charIndex}) | Key char: ${keyChar} (${keyIndex})`);
                        steps.push(`  Calculation: (${charIndex} + ${keyIndex}) mod 26 = ${newIndex}`);
                    } else {
                        newIndex = (charIndex - keyIndex + 26) % 26;
                        steps.push(`- Ciphertext char: ${char} (${charIndex}) | Key char: ${keyChar} (${keyIndex})`);
                        steps.push(`  Calculation: (${charIndex} - ${keyIndex} + 26) mod 26 = ${newIndex}`);
                    }
                    
                    const newChar = alphabet[newIndex];
                    result += newChar;
                    steps.push(`  Resulting character: ${newChar}`);
                } else {
                    result += char;
                    steps.push(`- Character "${char}" or key character "${keyChar}" is not in the alphabet. They remain unchanged.`);
                }
            }
            
            displayResult(result, steps, 'vernam-result');
        }
        
        /* --- Storage Formula Calculator Logic (Unchanged) --- */
        
        const conversionFactors = ['s', 'ms', 'us', 'ns'];
        const dataConversionFactors = ["B", "K", "M", "G"];
        const conversionMultipliers = [1, 1e3, 1e6, 1e9];
        const dataConversionMultipliers = [1, 1024, 1024**2, 1024**3];

        function displayToolResult(title, formula, steps, finalResult, finalUnit) {
            const resultBox = document.getElementById('tool-result');
            const formulaPre = resultBox.querySelector('.formula');
            const stepPre = resultBox.querySelector('.step-by-step');
            formulaPre.textContent = `Formula:\n${formula}`;
            stepPre.innerHTML = `--- Step-by-Step Breakdown ---\n${steps.join('\n')}\n\nFinal Result: ${finalResult} ${finalUnit}`;
            resultBox.style.display = 'block';
        }

        function convertToSeconds(valueStr) {
            const match = valueStr.match(/^([\d.]+)\s*([a-zA-Zμ]+)$/);
            if (!match) return null;
            const value = parseFloat(match[1]);
            const unit = match[2];
            let multiplier = 1;
            switch(unit) {
                case 's': multiplier = 1; break;
                case 'ms': multiplier = 1e-3; break;
                case 'us': case 'μs': multiplier = 1e-6; break;
                case 'ns': multiplier = 1e-9; break;
                default: return null;
            }
            return value * multiplier;
        }

        function convertFromSeconds(valueSeconds, targetUnit) {
            const index = conversionFactors.indexOf(targetUnit);
            if (index === -1) return valueSeconds;
            return valueSeconds * conversionMultipliers[index];
        }

        function getInputs() {
            return {
                siUnit: document.getElementById('si-unit').value,
                hthTime: document.getElementById('hth-time').value,
                platters: parseFloat(document.getElementById('platters-count').value),
                tttTime: document.getElementById('ttt-time').value,
                tracks: parseFloat(document.getElementById('tracks-count').value),
                rpm: parseFloat(document.getElementById('rpm-speed').value),
                sectorsPerTrack: parseFloat(document.getElementById('sectors-per-track').value),
                bytesPerSector: parseFloat(document.getElementById('bytes-per-sector').value),
                dataSiUnit: document.getElementById('data-si-unit').value
            };
        }

        function calculateAad() {
            const { siUnit, hthTime, platters, tttTime, tracks, rpm } = getInputs();
            const steps = [];
            const hthSeconds = convertToSeconds(hthTime);
            const tttSeconds = convertToSeconds(tttTime);
            if (hthSeconds === null || tttSeconds === null) {
                const resultBox = document.getElementById('tool-result');
                resultBox.querySelector('.step-by-step').innerHTML = 'Invalid format for HTH or TTT. Use format "5us" or "1.2ms".';
                resultBox.style.display = 'block';
                return;
            }
            const recordingSurfaces = platters * 2;
            const headToHeadDelay = hthSeconds * (recordingSurfaces / 2);
            const trackToTrackDelay = (tracks / 2) * tttSeconds;
            const rotationalDelay = (60 / rpm) / 2;
            const totalDelaySeconds = headToHeadDelay + trackToTrackDelay + rotationalDelay;
            const totalDelaySi = convertFromSeconds(totalDelaySeconds, siUnit);
            steps.push(`- Head-To-Head Delay: (${hthSeconds}s × ${recordingSurfaces} / 2) = ${headToHeadDelay.toFixed(8)}s`);
            steps.push(`- Track-To-Track Seek: (${tracks} / 2 × ${tttSeconds}s) = ${trackToTrackDelay.toFixed(8)}s`);
            steps.push(`- Average Rotational Delay: (60s / ${rpm} / 2) = ${rotationalDelay.toFixed(8)}s`);
            steps.push(`- Total in seconds: ${headToHeadDelay.toFixed(8)}s + ${trackToTrackDelay.toFixed(8)}s + ${rotationalDelay.toFixed(8)}s = ${totalDelaySeconds.toFixed(8)}s`);
            steps.push(`- Final conversion to ${siUnit}: ${totalDelaySeconds.toFixed(8)}s × ${conversionMultipliers[conversionFactors.indexOf(siUnit)]} = ${totalDelaySi.toFixed(8)}${siUnit}`);
            const formula = `Average Access Delay = (HTH × Platters/2) + (Tracks/2 × TTT) + (60s/RPM ÷ 2)`;
            displayToolResult("Average Access Delay", formula, steps, totalDelaySi.toFixed(8), siUnit);
        }

        function calculateSat() {
            const { siUnit, rpm, sectorsPerTrack } = getInputs();
            const steps = [];
            const timePerSectorSeconds = (60 / rpm) / sectorsPerTrack;
            const timePerSectorSi = convertFromSeconds(timePerSectorSeconds, siUnit);
            steps.push(`- Time per rotation: 60s / ${rpm} = ${(60/rpm).toFixed(8)}s`);
            steps.push(`- Time per sector: ${(60/rpm).toFixed(8)}s / ${sectorsPerTrack} = ${timePerSectorSeconds.toFixed(8)}s`);
            steps.push(`- Final conversion to ${siUnit}: ${timePerSectorSeconds.toFixed(8)}s × ${conversionMultipliers[conversionFactors.indexOf(siUnit)]} = ${timePerSectorSi.toFixed(8)}${siUnit}`);
            const formula = `Sequential Access Time = 60s / (RPM × Sectors/Track)`;
            displayToolResult("Sequential Access Time", formula, steps, timePerSectorSi.toFixed(8), siUnit);
        }

        function calculateAat() {
            const { siUnit, hthTime, platters, tttTime, tracks, rpm, sectorsPerTrack } = getInputs();
            const steps = [];
            const hthSeconds = convertToSeconds(hthTime);
            const tttSeconds = convertToSeconds(tttTime);
            const recordingSurfaces = platters * 2;
            const headToHeadDelay = hthSeconds * (recordingSurfaces / 2);
            const trackToTrackDelay = (tracks / 2) * tttSeconds;
            const rotationalDelay = (60 / rpm) / 2;
            const aadSeconds = headToHeadDelay + trackToTrackDelay + rotationalDelay;
            const timePerSectorSeconds = (60 / rpm) / sectorsPerTrack;
            const aatSeconds = aadSeconds + timePerSectorSeconds;
            const aatSi = convertFromSeconds(aatSeconds, siUnit);
            steps.push(`- Average Access Delay (AAD): ${aadSeconds.toFixed(8)}s`);
            steps.push(`- Time to Read One Sector: ${timePerSectorSeconds.toFixed(8)}s`);
            steps.push(`- Total in seconds: ${aadSeconds.toFixed(8)}s + ${timePerSectorSeconds.toFixed(8)}s = ${aatSeconds.toFixed(8)}s`);
            steps.push(`- Final conversion to ${siUnit}: ${aatSeconds.toFixed(8)}s × ${conversionMultipliers[conversionFactors.indexOf(siUnit)]} = ${aatSi.toFixed(8)}${siUnit}`);
            const formula = `Average Access Time = AAD + Sequential Access Time`;
            displayToolResult("Average Access Time", formula, steps, aatSi.toFixed(8), siUnit);
        }

        function calculateMaxTransfer() {
            const { sectorsPerTrack, rpm, bytesPerSector, dataSiUnit } = getInputs();
            const steps = [];
            const timePerSectorSeconds = (60 / rpm) / sectorsPerTrack;
            const sectorsPerSecond = 1 / timePerSectorSeconds;
            const bytesPerSecond = sectorsPerSecond * bytesPerSector;
            const dataSiIndex = dataConversionFactors.indexOf(dataSiUnit);
            const finalData = bytesPerSecond / dataConversionMultipliers[dataSiIndex];
            steps.push(`- Sectors per second: 1 / ${timePerSectorSeconds.toFixed(8)} = ${sectorsPerSecond.toFixed(2)} sectors/s`);
            steps.push(`- Bytes per second: ${sectorsPerSecond.toFixed(2)} sectors/s × ${bytesPerSector} B/sector = ${bytesPerSecond.toFixed(2)}B/s`);
            steps.push(`- Final conversion to ${dataSiUnit}: ${bytesPerSecond.toFixed(2)}B/s / ${dataConversionMultipliers[dataSiIndex]} = ${finalData.toFixed(2)}${dataSiUnit}B/s`);
            const formula = `Maximum Data Transfer Rate = (1 / Sequential Access Time) × Bytes/Sector`;
            displayToolResult("Maximum Data Transfer Rate", formula, steps, finalData.toFixed(2), `${dataSiUnit}B/s`);
        }

        function calculateSustainedTransfer() {
            const { hthTime, platters, tttTime, tracks, rpm, sectorsPerTrack, bytesPerSector, dataSiUnit } = getInputs();
            const steps = [];
            const hthSeconds = convertToSeconds(hthTime);
            const tttSeconds = convertToSeconds(tttTime);
            const recordingSurfaces = platters * 2;
            const headToHeadDelay = hthSeconds * (recordingSurfaces / 2);
            const trackToTrackDelay = (tracks / 2) * tttSeconds;
            const rotationalDelay = (60 / rpm) / 2;
            const aadSeconds = headToHeadDelay + trackToTrackDelay + rotationalDelay;
            const timePerSectorSeconds = (60 / rpm) / sectorsPerTrack;
            const aatSeconds = aadSeconds + timePerSectorSeconds;
            const sectorsPerSecond = 1 / aatSeconds;
            const bytesPerSecond = sectorsPerSecond * bytesPerSector;
            const dataSiIndex = dataConversionFactors.indexOf(dataSiUnit);
            const finalData = bytesPerSecond / dataConversionMultipliers[dataSiIndex];
            steps.push(`- Average Access Time (AAT): ${aatSeconds.toFixed(8)}s`);
            steps.push(`- Sectors per second: 1 / ${aatSeconds.toFixed(8)} = ${sectorsPerSecond.toFixed(2)} sectors/s`);
            steps.push(`- Bytes per second: ${sectorsPerSecond.toFixed(2)} sectors/s × ${bytesPerSector} B/sector = ${bytesPerSecond.toFixed(2)}B/s`);
            steps.push(`- Final conversion to ${dataSiUnit}: ${bytesPerSecond.toFixed(2)}B/s / ${dataConversionMultipliers[dataSiIndex]} = ${finalData.toFixed(2)}${dataSiUnit}B/s`);
            const formula = `Sustained Data Transfer Rate = (1 / Average Access Time) × Bytes/Sector`;
            displayToolResult("Sustained Data Transfer Rate", formula, steps, finalData.toFixed(2), `${dataSiUnit}B/s`);
        }

        // --- Treasure Hunt Game ---
        let treasureGame = {};
        let treasureGameStats = {}; 

        function setupTreasureHunt() {
            const player1 = document.getElementById('player1-name').value;
            const player2 = document.getElementById('player2-name').value;
            const size = parseInt(document.getElementById('board-size').value, 10);

            if (player1 === player2) {
                alert("Player names must be unique.");
                return;
            }
            if (size < 5 || size % 2 === 0) {
                alert("Board size must be an odd number and at least 5.");
                return;
            }

            treasureGameStats = {
                players: [player1, player2],
                scores: [0, 0]
            };

            document.getElementById('treasure-setup').style.display = 'none';
            document.getElementById('treasure-game-area').style.display = 'block';

            startNewRound(size);
        }
        
        function showTreasureSetup() {
            document.getElementById('treasure-setup').style.display = 'block';
            document.getElementById('treasure-game-area').style.display = 'none';
        }

        function startNewRound(size) {
            const boardSize = size || treasureGame.boardSize;

            treasureGame = {
                players: treasureGameStats.players,
                boardSize: boardSize,
                board: getNewTreasureBoard(boardSize),
                scores: [0, 0], // Round scores
                currentPlayer: Math.random() < 0.5 ? 0 : 1,
                totalTreasures: Math.floor((boardSize * boardSize) / 2),
                treasuresFound: 0,
                gameOver: false,
                statsUpdated: false
            };
            
            renderTreasureBoard();
            updateGameStatus();
        }

        function getNewTreasureBoard(size) {
            const board = Array(size).fill(null).map(() => Array(size).fill(null).map(() => ({ hasTreasure: false, opened: false })));
            let treasuresPlaced = 0;
            const totalTreasures = Math.floor((size * size) / 2);

            while (treasuresPlaced < totalTreasures) {
                const row = Math.floor(Math.random() * size);
                const col = Math.floor(Math.random() * size);
                if (!board[row][col].hasTreasure) {
                    board[row][col].hasTreasure = true;
                    treasuresPlaced++;
                }
            }
            return board;
        }

        function renderTreasureBoard() {
            const boardElement = document.getElementById('treasure-board');
            boardElement.innerHTML = '';
            boardElement.style.gridTemplateColumns = `repeat(${treasureGame.boardSize}, 40px)`;

            treasureGame.board.forEach((row, r) => {
                row.forEach((cell, c) => {
                    const cellElement = document.createElement('div');
                    cellElement.classList.add('treasure-cell');
                    if (cell.opened) {
                        cellElement.classList.add('opened');
                        cellElement.textContent = cell.hasTreasure ? '💎' : '⚪';
                    } else {
                        cellElement.textContent = '❓';
                        if (!treasureGame.gameOver) {
                            cellElement.onclick = () => handleCellClick(r, c);
                        }
                    }
                    boardElement.appendChild(cellElement);
                });
            });
        }
        
        function handleCellClick(row, col) {
            if (treasureGame.gameOver || treasureGame.board[row][col].opened) {
                return;
            }

            const cell = treasureGame.board[row][col];
            cell.opened = true;

            if (cell.hasTreasure) {
                treasureGame.scores[treasureGame.currentPlayer]++;
                treasureGame.treasuresFound++;
            }

            checkGameOver();

            if (!treasureGame.gameOver) {
                treasureGame.currentPlayer = 1 - treasureGame.currentPlayer;
            }
            
            renderTreasureBoard();
            updateGameStatus();
        }

        function checkGameOver() {
            const winningScore = Math.floor(treasureGame.totalTreasures / 2) + 1;
            if (treasureGame.scores[0] >= winningScore || treasureGame.scores[1] >= winningScore || treasureGame.treasuresFound === treasureGame.totalTreasures) {
                treasureGame.gameOver = true;
            }
        }

        function updateGameStatus() {
            const statusElement = document.getElementById('treasure-game-status');
            const controlsElement = document.getElementById('treasure-game-controls');
            controlsElement.innerHTML = ''; // Clear previous controls
            
            let roundScoresText = `Round Score: ${treasureGame.players[0]} - ${treasureGame.scores[0]} | ${treasureGame.players[1]} - ${treasureGame.scores[1]}`;
            let overallScoresText = `Overall Score: ${treasureGameStats.players[0]} - ${treasureGameStats.scores[0]} | ${treasureGameStats.players[1]} - ${treasureGameStats.scores[1]}`;
            let statusText = '';

            if (treasureGame.gameOver) {
                let roundResultText = '';
                if (!treasureGame.statsUpdated) {
                    if (treasureGame.scores[0] > treasureGame.scores[1]) {
                        roundResultText = `<strong>${treasureGame.players[0]} wins the round!</strong>`;
                        treasureGameStats.scores[0] += 1;
                    } else if (treasureGame.scores[1] > treasureGame.scores[0]) {
                        roundResultText = `<strong>${treasureGame.players[1]} wins the round!</strong>`;
                        treasureGameStats.scores[1] += 1;
                    } else {
                        roundResultText = `<strong>It's a tie!</strong>`;
                        treasureGameStats.scores[0] += 0.5;
                        treasureGameStats.scores[1] += 0.5;
                    }
                    treasureGame.statsUpdated = true; // Prevent scores from updating multiple times
                }
                 // Re-fetch the result text if already updated
                else {
                     if (treasureGame.scores[0] > treasureGame.scores[1]) {
                        roundResultText = `<strong>${treasureGame.players[0]} wins the round!</strong>`;
                    } else if (treasureGame.scores[1] > treasureGame.scores[0]) {
                        roundResultText = `<strong>${treasureGame.players[1]} wins the round!</strong>`;
                    } else {
                        roundResultText = `<strong>It's a tie!</strong>`;
                    }
                }
                
                overallScoresText = `Overall Score: ${treasureGameStats.players[0]} - ${treasureGameStats.scores[0]} | ${treasureGameStats.players[1]} - ${treasureGameStats.scores[1]}`;
                statusText = `${roundScoresText}<br>${roundResultText}<br>${overallScoresText}`;
                
                const rematchButton = document.createElement('button');
                rematchButton.textContent = 'Rematch';
                rematchButton.onclick = () => startNewRound();
                controlsElement.appendChild(rematchButton);

            } else {
                statusText = `${roundScoresText}<br>${overallScoresText}<br>Current Turn: <strong>${treasureGame.players[treasureGame.currentPlayer]}</strong>`;
            }
            
            const newGameButton = document.createElement('button');
            newGameButton.textContent = 'New Game (Reset All)';
            newGameButton.onclick = showTreasureSetup;
            controlsElement.appendChild(newGameButton);
            
            statusElement.innerHTML = statusText;
        }
        
    </script>

</body>
</html>
